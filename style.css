/* =========================
   Serag | سراج — RTL SPA
   Fix: Scroll works (no absolute panels + content scroll)
   ========================= */

/* Base reset */
*{margin:0;padding:0;box-sizing:border-box}
html,body{height:100%}
body{
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, "Noto Sans Arabic", "Noto Sans", sans-serif;
  background: radial-gradient(1200px 700px at 20% 20%, rgba(124,58,237,.18), transparent 55%),
              radial-gradient(900px 600px at 80% 30%, rgba(59,130,246,.16), transparent 55%),
              radial-gradient(900px 600px at 60% 90%, rgba(236,72,153,.12), transparent 55%),
              linear-gradient(135deg, #070913 0%, #0b1024 40%, #070913 100%);
  color: rgba(255,255,255,.9);
  overflow-x:hidden;
  overflow-y:auto; /* ✅ allow page scroll */
}

/* Theme tokens */
:root{
  --bgA:#070913;
  --bgB:#0b1024;
  --panel: rgba(255,255,255,.04);
  --panel2: rgba(255,255,255,.06);
  --stroke: rgba(255,255,255,.08);
  --stroke2: rgba(255,255,255,.12);
  --text: rgba(255,255,255,.92);
  --muted: rgba(255,255,255,.55);
  --muted2: rgba(255,255,255,.35);
  --shadow: 0 25px 50px -14px rgba(0,0,0,.55);
  --shadow2: 0 12px 30px rgba(0,0,0,.25);
  --grad: linear-gradient(135deg, #6366f1 0%, #a855f7 55%, #22d3ee 115%);
  --grad2: linear-gradient(135deg, rgba(99,102,241,.22), rgba(168,85,247,.16));
  --danger: linear-gradient(135deg, rgba(239,68,68,.9), rgba(244,63,94,.85));
  --radius: 22px;
  --radius2: 16px;
  --blur: blur(22px);
  --focus: 0 0 0 3px rgba(99,102,241,.24);
}

[data-theme="light"]{
  --bgA:#f7f8ff;
  --bgB:#eef2ff;
  --panel: rgba(20,24,40,.05);
  --panel2: rgba(20,24,40,.07);
  --stroke: rgba(20,24,40,.10);
  --stroke2: rgba(20,24,40,.14);
  --text: rgba(10,12,18,.92);
  --muted: rgba(10,12,18,.60);
  --muted2: rgba(10,12,18,.42);
  --shadow: 0 20px 40px -18px rgba(10,12,18,.24);
  --shadow2: 0 10px 26px rgba(10,12,18,.12);
}

/* Background Canvas */
#bgCanvas{
  position:fixed; inset:0;
  width:100%; height:100%;
  z-index:0;
  pointer-events:none;
  opacity:.75;
}

/* App shell */
.appShell{position:relative; z-index:1; padding:20px;}

/* Topbar (mobile) */
.topbar{
  position:sticky; top:0; z-index:50;
  display:none;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  padding:14px 14px;
  margin: 0 0 14px;
  border-radius: 18px;
  background: var(--panel);
  border: 1px solid var(--stroke);
  backdrop-filter: var(--blur);
  box-shadow: var(--shadow2);
}

.icon-btn{
  width:44px;height:44px;
  border-radius:14px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  color: var(--text);
  cursor:pointer;
  transition: transform .18s ease, background .25s ease, border-color .25s ease;
}
.icon-btn:hover{transform: translateY(-1px); background: rgba(255,255,255,.07); border-color: var(--stroke2)}
.icon-btn:active{transform: translateY(0px) scale(.98)}
.icon-btn:focus-visible{outline:none; box-shadow: var(--focus)}

.brand{display:flex; align-items:center; gap:10px}
.brandMark{
  width:14px;height:14px; border-radius:999px;
  background: var(--grad);
  box-shadow: 0 0 20px rgba(168,85,247,.35);
}
.brandTitle{font-weight:900; letter-spacing:-.03em}
.brandSub{font-size:.78rem; color: var(--muted2); margin-top:2px}

/* Overlay */
.overlay{
  position:fixed; inset:0;
  background: rgba(0,0,0,.55);
  z-index:60;
  backdrop-filter: blur(2px);
}

/* Main container */
.main-container{
  width:100%;
  max-width: 1220px;
  margin: 0 auto;
  background: var(--panel);
  border: 1px solid var(--stroke);
  border-radius: var(--radius);
  backdrop-filter: var(--blur);
  box-shadow: var(--shadow), inset 0 1px 0 rgba(255,255,255,.10);
  display:flex;
  overflow:hidden;

  /* ✅ Scroll fix helper */
  max-height: calc(100vh - 40px);
  align-items: stretch;
}

/* Sidebar nav (RTL on right) */
.tabs-nav{
  width: 310px;
  min-width: 310px;
  padding: 18px 14px;
  display:flex;
  flex-direction:column;
  gap:10px;

  background: linear-gradient(180deg, rgba(10,12,22,.74), rgba(10,12,22,.92));
  border-left: 1px solid var(--stroke); /* RTL separator */
  position: relative;
}

/* subtle edge glow */
.tabs-nav::before{
  content:"";
  position:absolute;
  top:0; left:0;
  width:1px; height:100%;
  background: linear-gradient(180deg, transparent, rgba(99,102,241,.45), transparent);
  opacity:.7;
}

.navTop{display:flex; flex-direction:column; gap:10px}
.nav-header{
  padding: 8px 10px 12px;
  border-bottom: 1px solid var(--stroke);
  display:flex;
  align-items:flex-start;
  justify-content:space-between;
  gap:10px;
}
.logoRow{display:flex; gap:10px; align-items:center}
.logoOrb{
  width:38px;height:38px;border-radius:14px;
  background: var(--grad2);
  border:1px solid rgba(99,102,241,.25);
  box-shadow: 0 10px 30px rgba(99,102,241,.15);
  position:relative;
}
.logoOrb::after{
  content:"";
  position:absolute; inset:-1px;
  border-radius:14px;
  background: radial-gradient(circle at 30% 30%, rgba(255,255,255,.18), transparent 55%);
  pointer-events:none;
}
.nav-header h2{
  font-size:1.1rem;
  font-weight: 900;
  letter-spacing:-.02em;
  color: var(--text);
}
.nav-header p{
  font-size:.72rem;
  color: var(--muted2);
  margin-top:4px;
  text-transform: uppercase;
  letter-spacing:.10em;
}

.navActions{display:flex; gap:8px}
.pill{
  width:44px;height:38px;
  border-radius: 999px;
  border: 1px solid var(--stroke);
  background: rgba(255,255,255,.05);
  color: var(--text);
  cursor:pointer;
  transition: transform .18s ease, background .25s ease;
}
.pill:hover{transform: translateY(-1px); background: rgba(255,255,255,.08)}
.pill:active{transform: scale(.98)}
.pill:focus-visible{outline:none; box-shadow: var(--focus)}

.quickMeta{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
  padding: 0 10px;
}
.metaCard{
  background: rgba(255,255,255,.04);
  border: 1px solid var(--stroke);
  border-radius: 16px;
  padding: 12px 12px;
  position:relative;
  overflow:hidden;
}
.metaCard::after{
  content:"";
  position:absolute; inset:-60px;
  background: radial-gradient(circle at 20% 20%, rgba(99,102,241,.16), transparent 50%),
              radial-gradient(circle at 80% 60%, rgba(168,85,247,.12), transparent 55%);
  opacity:.9;
  pointer-events:none;
}
.metaLabel{font-size:.72rem; color: var(--muted2); position:relative}
.metaValue{font-size:1.25rem; font-weight:900; letter-spacing:-.02em; position:relative}
.metaHint{font-size:.7rem; color: var(--muted2); margin-top:2px; position:relative}

.navBtns{display:flex; flex-direction:column; gap:8px; padding: 0 6px}
.tab-btn{
  position:relative;
  display:flex;
  align-items:center;
  gap:12px;
  padding: 14px 14px;
  border-radius: 16px;
  border: 1px solid transparent;
  background: transparent;
  cursor:pointer;
  text-align:right;
  transition: transform .28s cubic-bezier(.2,.8,.2,1), background .28s ease, border-color .28s ease;
  overflow:hidden;
}
.tab-btn::before{
  content:"";
  position:absolute; inset:0;
  background: var(--grad2);
  opacity:0;
  transition: opacity .28s ease;
}
.tab-btn::after{
  content:"";
  position:absolute;
  right:0; top:50%;
  transform: translateY(-50%) scaleY(0);
  width:3px;height:60%;
  border-radius: 4px 0 0 4px;
  background: var(--grad);
  transition: transform .28s cubic-bezier(.2,.8,.2,1);
}
.tab-btn:hover{
  transform: translateY(-1px);
  background: rgba(255,255,255,.03);
  border-color: var(--stroke);
}
.tab-btn:hover::before{opacity:.45}
.tab-btn.active{
  border-color: rgba(99,102,241,.30);
  box-shadow: 0 10px 24px rgba(99,102,241,.14), inset 0 1px 0 rgba(255,255,255,.10);
}
.tab-btn.active::before{opacity:1}
.tab-btn.active::after{transform: translateY(-50%) scaleY(1)}

.tab-icon{
  width:42px; height:42px;
  border-radius: 14px;
  background: rgba(255,255,255,.05);
  border: 1px solid var(--stroke);
  display:flex;
  align-items:center;
  justify-content:center;
  font-size: 1.05rem;
  position:relative;
  z-index:1;
  transition: transform .28s ease, background .28s ease;
}
.tab-btn.active .tab-icon{
  background: var(--grad);
  border-color: transparent;
  transform: translateY(-1px);
  box-shadow: 0 14px 30px rgba(168,85,247,.22);
}
.tab-text{position:relative; z-index:1; flex:1}
.tab-title{display:block; font-weight:800; color: rgba(255,255,255,.78); letter-spacing:-.01em}
.tab-subtitle{display:block; font-size:.75rem; color: var(--muted2); margin-top:2px}
.tab-btn.active .tab-title{color: var(--text)}
.tab-arrow{position:relative; z-index:1; opacity:0; transform: translateX(-8px); transition: all .28s ease}
.tab-btn.active .tab-arrow{opacity:1; transform: translateX(0)}

/* Footer */
.navFooter{
  margin-top:auto;
  padding: 10px 10px 6px;
  border-top: 1px solid var(--stroke);
  display:flex;
  flex-direction:column;
  gap:8px;
}
.privacy{
  display:flex;
  align-items:center;
  gap:8px;
  color: var(--muted);
  font-size:.85rem;
}
.dot{
  width:8px;height:8px;border-radius:999px;
  background: rgba(34,211,238,.9);
  box-shadow: 0 0 16px rgba(34,211,238,.35);
}
.disclaimer{color: var(--muted2)}

/* Content area */
.tabs-content{
  flex:1;
  padding: 26px 30px;
  position:relative;

  /* ✅ FIX: allow scroll */
  overflow-y: auto;
  overflow-x: hidden;
  scrollbar-gutter: stable;
  -webkit-overflow-scrolling: touch;
}

/* Skeleton */
.skeleton{display:none}
.skeleton.on{display:block}
.sk{background: rgba(255,255,255,.06); border:1px solid var(--stroke); border-radius: 16px; position:relative; overflow:hidden}
.sk::after{
  content:"";
  position:absolute; inset:0;
  background: linear-gradient(90deg, transparent, rgba(255,255,255,.08), transparent);
  transform: translateX(-120%);
  animation: shimmer 1.3s infinite;
}
@keyframes shimmer{to{transform: translateX(120%)}}
.skRow{display:grid; gap:10px; margin-bottom:18px}
.skTitle{height:44px}
.skLine{height:18px}
.skGrid{display:grid; grid-template-columns:repeat(3,1fr); gap:12px}
.skCard{height:130px}

/* Panels */
.tab-panel{
  display:none; /* ✅ FIX: not absolute */
  opacity:0;
  transform: translateX(-18px);
}
.tab-panel.active{
  display:block;
  opacity:1;
  transform: translateX(0);
  animation: panelIn .28s ease;
}
@keyframes panelIn{
  from{opacity:0; transform: translateX(-18px)}
  to{opacity:1; transform: translateX(0)}
}

.panel-header{margin-bottom:16px; padding-bottom:14px; border-bottom:1px solid var(--stroke)}
.panel-badge{
  display:inline-block;
  padding:6px 12px;
  border-radius:999px;
  border:1px solid rgba(99,102,241,.30);
  background: rgba(99,102,241,.14);
  color: rgba(167,139,250,.98);
  font-size:.72rem;
  font-weight:900;
  letter-spacing:.10em;
  text-transform: uppercase;
  margin-bottom:10px;
}
.panel-title{
  font-size: 2.05rem;
  font-weight: 950;
  letter-spacing:-.03em;
  color: var(--text);
  margin-bottom:6px;
}
.panel-description{
  max-width: 760px;
  color: var(--muted);
  line-height:1.7;
}

/* Card */
.content-card{
  background: var(--panel);
  border: 1px solid var(--stroke);
  border-radius: var(--radius2);
  padding: 18px;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
  transition: transform .28s cubic-bezier(.2,.8,.2,1), border-color .28s ease, background .28s ease, box-shadow .28s ease;
}
.content-card:hover{
  transform: translateY(-2px);
  border-color: rgba(99,102,241,.32);
  background: var(--panel2);
  box-shadow: var(--shadow2), inset 0 1px 0 rgba(255,255,255,.10);
}
.card-header{display:flex; align-items:center; gap:10px; margin-bottom:10px}
.card-icon{
  width:38px; height:38px;
  border-radius: 14px;
  background: rgba(99,102,241,.14);
  border: 1px solid rgba(99,102,241,.22);
  display:flex; align-items:center; justify-content:center;
}
.card-title{font-weight:900; letter-spacing:-.02em}
.card-text{color: var(--muted); line-height:1.75}

/* Buttons */
.btn{
  border:none;
  border-radius: 16px;
  padding: 12px 14px;
  cursor:pointer;
  font-weight: 900;
  letter-spacing:-.01em;
  transition: transform .20s ease, filter .25s ease, background .25s ease, border-color .25s ease;
  user-select:none;
}
.btn:focus-visible{outline:none; box-shadow: var(--focus)}
.btn.primary{
  background: var(--grad);
  color: #fff;
  box-shadow: 0 14px 28px rgba(168,85,247,.22);
}
.btn.primary:hover{transform: translateY(-1px); filter: brightness(1.06)}
.btn.ghost{
  background: rgba(255,255,255,.04);
  color: var(--text);
  border: 1px solid var(--stroke);
}
.btn.ghost:hover{transform: translateY(-1px); background: rgba(255,255,255,.07); border-color: var(--stroke2)}
.btn.danger{
  background: var(--danger);
  color:#fff;
}
.btn.danger:hover{transform: translateY(-1px); filter: brightness(1.04)}
.btn:disabled{opacity:.55; cursor:not-allowed; transform:none}

/* Layout helpers */
.grid2{display:grid; grid-template-columns:1fr 1fr; gap:14px}
.row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
.formRow{display:flex; gap:10px; align-items:end; flex-wrap:wrap}
.field{flex:1; min-width: 220px}
label{display:block; font-size:.85rem; color: var(--muted2); margin-bottom:6px}
input, select, textarea{
  width:100%;
  border-radius: 16px;
  padding: 12px 12px;
  border: 1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  color: var(--text);
  outline:none;
  transition: border-color .22s ease, background .22s ease, transform .18s ease;
}
input:focus, select:focus, textarea:focus{
  border-color: rgba(99,102,241,.45);
  background: rgba(255,255,255,.06);
}
.smallHint{margin-top:10px; color: var(--muted2); font-size:.88rem}

/* Hero */
.hero{
  display:grid;
  grid-template-columns: 1.2fr .9fr;
  gap:14px;
  margin: 16px 0 18px;
  position:relative;
}
.heroGlow{
  position:absolute; inset:-60px;
  background: radial-gradient(circle at 30% 20%, rgba(99,102,241,.18), transparent 45%),
              radial-gradient(circle at 70% 40%, rgba(168,85,247,.14), transparent 50%),
              radial-gradient(circle at 60% 80%, rgba(34,211,238,.10), transparent 55%);
  filter: blur(14px);
  pointer-events:none;
  opacity:.9;
}
.heroContent,.heroCards{position:relative}
.heroContent{
  background: rgba(255,255,255,.03);
  border:1px solid var(--stroke);
  border-radius: var(--radius);
  padding: 18px;
  overflow:hidden;
}
.heroContent::after{
  content:"";
  position:absolute; inset:-1px;
  border-radius: var(--radius);
  background: linear-gradient(135deg, rgba(255,255,255,.08), transparent 55%);
  pointer-events:none;
  opacity:.55;
}
.heroTitle{font-size: 2.0rem; font-weight: 950; letter-spacing:-.03em; color: var(--text)}
.gradText{
  background: var(--grad);
  -webkit-background-clip:text;
  background-clip:text;
  -webkit-text-fill-color:transparent;
}
.heroText{color: var(--muted); margin-top:10px; line-height:1.8}
.heroActions{display:flex; gap:10px; margin-top:14px; flex-wrap:wrap}

.actionsGrid{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap:10px;
  margin-top:14px;
}
.actionCard{
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  border-radius: 18px;
  padding: 12px 12px;
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
  transition: transform .25s ease, border-color .25s ease, background .25s ease;
}
.actionCard:hover{transform: translateY(-2px); background: rgba(255,255,255,.07); border-color: rgba(99,102,241,.30)}
.acIcon{width:40px;height:40px;border-radius:16px; display:flex;align-items:center;justify-content:center; background: rgba(99,102,241,.14); border:1px solid rgba(99,102,241,.22)}
.acTitle{font-weight:950}
.acSub{font-size:.80rem; color: var(--muted2); margin-top:2px}
.acArrow{margin-right:auto; color: var(--muted2)}

.heroCards{display:grid; gap:14px}
.statRow{display:flex; gap:10px; margin-top:12px}
.miniStat{flex:1; padding:12px; border-radius:16px; border:1px solid var(--stroke); background: rgba(255,255,255,.04)}
.miniVal{font-weight:950; font-size: 1.15rem}
.miniLab{color: var(--muted2); font-size:.78rem; margin-top:2px}

.sectionTitle{margin: 12px 0 10px}
.sectionTitle h3{font-weight:950}
.sectionTitle p{color: var(--muted2); margin-top:4px}

.chips{display:flex; flex-wrap:wrap; gap:8px; margin-top:10px}
.chip{
  padding: 8px 10px;
  border-radius: 999px;
  border: 1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  font-size: .85rem;
  color: var(--text);
  cursor:default;
}
.emptyMini{color: var(--muted2); margin-top:10px}

/* Tilt */
.tilt{transform-style: preserve-3d}
.tilt::after{
  content:"";
  position:absolute; inset:-1px;
  border-radius: inherit;
  pointer-events:none;
  background: radial-gradient(circle at var(--mx,50%) var(--my,50%), rgba(255,255,255,.10), transparent 55%);
  opacity:.7;
}

/* Empty states */
.emptyState{
  border:1px dashed rgba(255,255,255,.16);
  background: rgba(255,255,255,.03);
  border-radius: 18px;
  padding: 16px;
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
  gap:6px;
  margin-top:10px;
}
.emptyIcon{font-size: 1.6rem}
.emptyTitle{font-weight:950}
.emptySub{color: var(--muted2); font-size:.9rem}

/* Subject list & drop zones */
.subjectList{display:flex; flex-direction:column; gap:10px; margin-top:10px}
.subjectItem{
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  border-radius: 18px;
  padding: 12px;
  display:flex;
  align-items:center;
  gap:10px;
  position:relative;
  transition: border-color .22s ease, background .22s ease, transform .22s ease;
}
.subjectItem:hover{transform: translateY(-1px); border-color: rgba(99,102,241,.30); background: rgba(255,255,255,.06)}
.subDot{
  width:12px;height:12px;border-radius:999px;
  background: var(--grad);
  box-shadow: 0 0 18px rgba(168,85,247,.22);
}
.subName{font-weight:950}
.subMeta{color: var(--muted2); font-size:.82rem; margin-top:2px}
.subTxt{display:flex; flex-direction:column}
.subDrop{
  margin-right:auto;
  border-radius: 14px;
  padding: 8px 10px;
  border:1px dashed rgba(255,255,255,.18);
  background: rgba(0,0,0,.10);
  color: var(--muted2);
  font-size:.82rem;
}
.subjectItem.dragOver{
  border-color: rgba(34,211,238,.45);
  background: rgba(34,211,238,.06);
}
.iconMini{
  width:40px;height:40px;border-radius:14px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  color: var(--text);
  cursor:pointer;
  transition: transform .18s ease, background .25s ease;
}
.iconMini:hover{transform: translateY(-1px); background: rgba(255,255,255,.07)}
.iconMini:active{transform: scale(.98)}

/* Timer */
.timerWrap{display:grid; grid-template-columns:1.15fr .85fr; gap:14px}
.dialCard{overflow:hidden}
.dialTop{display:flex; align-items:center; justify-content:space-between; gap:10px}
.dialMode{display:flex; gap:8px}
.seg{
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  color: var(--text);
  border-radius: 999px;
  padding: 10px 12px;
  cursor:pointer;
  font-weight:950;
  transition: transform .18s ease, background .22s ease, border-color .22s ease;
}
.seg:hover{transform: translateY(-1px); background: rgba(255,255,255,.07)}
.seg.active{border-color: rgba(99,102,241,.35); background: rgba(99,102,241,.14)}
.pillTag{
  display:inline-flex; align-items:center; gap:8px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  border-radius: 999px;
  padding: 8px 10px;
  color: var(--muted);
  font-size:.85rem;
}
.dialStage{display:flex; justify-content:center; margin-top:14px}

.dial{
  width: 320px; height: 320px;
  border-radius: 999px;
  position:relative;
  background: rgba(255,255,255,.04);
  border: 1px solid var(--stroke);
  box-shadow: 0 25px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.10);
  transform-style: preserve-3d;
  touch-action: none; /* ✅ important during drag */
}
.dialRing{
  position:absolute; inset:14px;
  border-radius:999px;
  background:
    radial-gradient(circle at 35% 30%, rgba(255,255,255,.12), transparent 55%),
    conic-gradient(from 180deg, rgba(99,102,241,.0), rgba(168,85,247,.55), rgba(34,211,238,.30), rgba(99,102,241,.0));
  filter: drop-shadow(0 18px 34px rgba(168,85,247,.18));
}
.dialInner{
  position:absolute; inset: 40px;
  border-radius: 999px;
  background: rgba(0,0,0,.18);
  border: 1px solid rgba(255,255,255,.10);
  backdrop-filter: blur(12px);
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:8px;
  transform: translateZ(22px);
}
.dialTime{font-size: 2.3rem; font-weight: 950; letter-spacing:-.03em}
.dialSub{color: var(--muted2)}
.dialNeedle{
  position:absolute;
  width: 4px; height: 46%;
  top: 10%;
  left: 50%;
  transform: translateX(-50%) rotate(0deg);
  transform-origin: bottom center;
  background: var(--grad);
  border-radius: 999px;
  filter: drop-shadow(0 0 16px rgba(168,85,247,.25));
}
.timerControls{margin-top:16px}
.timerControls .row{margin-top:10px}
#timerState{margin-top:12px}

/* Notebooks */
.notebookGrid{
  display:grid;
  grid-template-columns: repeat(2, 1fr);
  gap:12px;
  margin-top:10px;
}
.book{
  position:relative;
  height: 170px;
  border-radius: 18px;
  border: 1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  overflow:hidden;
  cursor:grab;
  transform-style:preserve-3d;
  transition: transform .25s ease, border-color .25s ease, background .25s ease;
  touch-action: none; /* ✅ rotate drag */
}
.book:active{cursor:grabbing}
.book:hover{
  border-color: rgba(99,102,241,.30);
  background: rgba(255,255,255,.06);
}
.book::before{
  content:"";
  position:absolute; inset:0;
  background:
    linear-gradient(90deg, rgba(255,255,255,.10), transparent 35%),
    radial-gradient(circle at 20% 20%, rgba(99,102,241,.18), transparent 55%);
  opacity:.75;
  pointer-events:none;
}
.bookCover{
  position:absolute; inset:12px 12px 12px 28px;
  border-radius: 14px;
  background: linear-gradient(135deg, rgba(99,102,241,.22), rgba(168,85,247,.14));
  border:1px solid rgba(255,255,255,.10);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.12);
  transform: translateZ(18px);
}
.bookSpine{
  position:absolute; top:12px; bottom:12px; right:12px;
  width: 14px;
  border-radius: 10px;
  background: rgba(0,0,0,.22);
  border:1px solid rgba(255,255,255,.10);
  transform: translateZ(22px);
}
.bookPages{
  position:absolute; top:20px; bottom:20px; left:18px; right:24px;
  border-radius: 12px;
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.03));
  opacity:.65;
  transform: translateZ(8px);
}
.bookTitle{
  position:absolute; left:22px; top:18px;
  font-weight:950;
  transform: translateZ(26px);
}
.bookLink{
  position:absolute; left:22px; bottom:16px;
  font-size:.85rem; color: var(--muted2);
  transform: translateZ(26px);
}
.bookBadge{
  position:absolute; right:20px; bottom:16px;
  padding: 6px 10px;
  border-radius: 999px;
  border:1px solid var(--stroke);
  background: rgba(0,0,0,.18);
  color: var(--muted);
  font-size:.82rem;
  transform: translateZ(28px);
}

/* Editor */
.editorCard{margin-top:14px}
.editorTop{
  display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap;
  margin-bottom:12px;
}
.editorTitle{font-weight:950; font-size:1.2rem}
.editorMeta{display:flex; gap:10px; align-items:center; margin-top:6px}
.saveState{color: var(--muted2); font-size:.9rem}
.editorActions{display:flex; gap:10px; align-items:center}
.miniSelect{min-width: 220px}
.editor{
  min-height: 220px;
  resize: vertical;
  line-height: 1.9;
}

/* Tasks */
.taskList{display:flex; flex-direction:column; gap:10px; margin-top:12px}
.task{
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  border-radius: 18px;
  padding: 12px;
  display:flex;
  align-items:center;
  gap:10px;
  transition: transform .20s ease, border-color .22s ease, background .22s ease;
}
.task:hover{transform: translateY(-1px); background: rgba(255,255,255,.06); border-color: rgba(99,102,241,.26)}
.chk{
  width: 22px; height: 22px;
  border-radius: 7px;
  border: 1px solid var(--stroke2);
  background: rgba(0,0,0,.15);
  display:flex; align-items:center; justify-content:center;
  cursor:pointer;
}
.task.done .chk{
  background: rgba(34,211,238,.22);
  border-color: rgba(34,211,238,.35);
}
.taskText{flex:1}
.task.done .taskText{
  text-decoration: line-through;
  color: var(--muted2);
}
.taskActions{display:flex; gap:8px}

/* Stats */
.statsGrid{
  display:grid;
  grid-template-columns: repeat(3,1fr);
  gap:10px;
  margin-top:12px;
}
.statItem{
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  border-radius: 16px;
  padding: 12px;
  text-align:center;
}
.statValue{
  font-weight:950;
  font-size: 1.35rem;
  background: var(--grad);
  -webkit-background-clip:text;
  background-clip:text;
  -webkit-text-fill-color:transparent;
}
.statLabel{color: var(--muted2); font-size:.85rem; margin-top:4px}
.canvasWrap{margin-top:12px; border-radius: 16px; border:1px solid var(--stroke); background: rgba(0,0,0,.12); overflow:hidden}
canvas{display:block; width:100%; height:auto}

/* Toggle */
.toggleRow{display:flex; align-items:center; justify-content:space-between; gap:10px}
.tTitle{font-weight:950}
.tSub{color: var(--muted2); margin-top:4px; font-size:.9rem}
.toggle{
  width:64px; height:34px;
  border-radius: 999px;
  border:1px solid var(--stroke);
  background: rgba(255,255,255,.04);
  cursor:pointer;
  position:relative;
  transition: background .25s ease, border-color .25s ease;
}
.toggle .knob{
  position:absolute; top:4px; right:4px;
  width:26px;height:26px;border-radius:999px;
  background:#fff;
  box-shadow: 0 10px 18px rgba(0,0,0,.25);
  transition: transform .25s cubic-bezier(.2,.8,.2,1);
}
.toggle.on{
  background: rgba(99,102,241,.20);
  border-color: rgba(99,102,241,.35);
}
.toggle.on .knob{transform: translateX(-30px)}
.fileBtn{position:relative; overflow:hidden}
.fileBtn input{position:absolute; inset:0; opacity:0; cursor:pointer}

/* Toasts */
.toasts{
  position:fixed;
  left: 20px;
  bottom: 20px;
  display:flex;
  flex-direction:column;
  gap:10px;
  z-index: 100;
}
.toast{
  min-width: 260px;
  max-width: 360px;
  border-radius: 16px;
  border:1px solid var(--stroke);
  background: rgba(10,12,22,.65);
  backdrop-filter: var(--blur);
  box-shadow: var(--shadow2);
  padding: 12px 12px;
  display:flex;
  align-items:flex-start;
  gap:10px;
  transform: translateY(10px);
  opacity:0;
  animation: toastIn .25s ease forwards;
}
@keyframes toastIn{to{transform: translateY(0); opacity:1}}
.toastIcon{
  width:34px;height:34px;border-radius:14px;
  background: rgba(99,102,241,.18);
  border:1px solid rgba(99,102,241,.22);
  display:flex;align-items:center;justify-content:center;
}
.toastTitle{font-weight:950}
.toastText{color: var(--muted2); font-size:.88rem; margin-top:2px}

/* Responsive */
@media (max-width: 980px){
  .topbar{display:flex}
  .appShell{padding: 14px}
  .main-container{
    max-height: none;
  }

  /* Drawer behavior */
  .tabs-nav{
    position:fixed;
    top: 12px;
    right: 12px;
    bottom: 12px;
    z-index: 70;
    border-left: 1px solid var(--stroke);
    border-radius: 22px;
    box-shadow: var(--shadow);
    transform: translateX(110%);
    transition: transform .28s cubic-bezier(.2,.8,.2,1);
  }
  .tabs-nav.open{transform: translateX(0)}
  .tabs-content{padding: 18px}
  .hero{grid-template-columns: 1fr; }
  .actionsGrid{grid-template-columns: 1fr}
  .timerWrap{grid-template-columns: 1fr}
  .grid2{grid-template-columns: 1fr}
  .skGrid{grid-template-columns: 1fr}
  .notebookGrid{grid-template-columns: 1fr}
  .statsGrid{grid-template-columns: 1fr}
}

/* Reduce motion */
@media (prefers-reduced-motion: reduce){
  *{animation:none !important; transition:none !important}
}
